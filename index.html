<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
   <meta id="myViewport" name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=yes, minimum-scale=1.0, maximum-scale=1.0" />
        <style media="screen">
        /* Style inputs */
             input[type=text], input[type=email], textarea {
          width: 100%;
          padding: 12px 20px;
          margin: 8px 0;
          display: inline-block;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          background-color: aliceblue;
        }
        
         

        /* Style the submit button */
     /* Style the submit button */
        button {
          width: 100%;
          background-color: #4CAF50;
          color: white;
          padding: 14px 20px;
          margin: 8px 0;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: large;
        }

        /* Add a background color to the submit button on mouse-over */
        input[type=submit]:hover {
          background-color: #45a049;
        }
        table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
      </style>
    <title>Welcome to Aqua-Aerobic Systems, Inc</title>
  </head>
  <body style="font-family: sans-serif;font-size: large;">
    <h1 style="text-align: center;">Welcome to Aqua-Aerobic Systems, Inc</h1>
    <div id="header"> <h2 style="text-align: center;">Enter below data to get your QR Code!</h2></div>
    <div id="qr" style="display: none;">
    <center>
    <div id="note"></div><br>    
    <canvas id="qrcode"></canvas><br>
    <div id="createrecord"></div><br><br>
    </center>
    </div>
    <form>
      <div id="container">
      <label for="fname" style="color: black;font-weight: bold;">First Name</label>
      <input type="text" id="fname" name="fname" placeholder="Enter your first name..">
      
       <label for="lname" style="color: black;font-weight: bold;">Last Name</label>
      <input type="text" id="lname" name="lname" placeholder="Enter your last name..">
        
      <label for="email" style="color: black;font-weight: bold;">Email</label>
      <input type="text" id="email" name="email" placeholder="Enter your email..">
      
      <label for="cname" style="color: black;font-weight: bold;">Company Name</label>
      <input type="text" id="cname" name="cname" placeholder="Enter your compnay name..">
        
      <label for="message" style="color: black;font-weight: bold;">Aqua Employee & Purpose of Visit</label>
     <textarea id="message" name="message" placeholder="Enter the name of the person you are here to see and purpose of visit.." style="height: 50px;font-family: sans-serif;"></textarea>
 
      <br>
        <label for="date" style="color: black;font-weight: bold;">Date & Time of Meeting</label><br><br>
       <input type="datetime-local" id="date" name="date" style="font-family: sans-serif;"><br><br>
  <button id="get_qr_code" type="button" style="background-color: cadetblue;">Get QR Code</button>
    
     </div>
     <button id="reset" type="button" style="background-color: red;width: fit-content;">Reset Form</button>
    </form>
            </div>
    <div id="table"></div>
  </body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script type="text/javascript">
    (function() {
      var mobile = '';
      var ipad = '';
      document.getElementById('reset').style.visibility = 'hidden';
      var viewport_meta = document.getElementById('viewport-meta');
      var get_qr_code = function(){
        var fname = document.getElementById("fname");
        console.log(fname.value.trim());
        var lname = document.getElementById("lname");
         console.log(lname.value.trim());
        var email = document.getElementById("email");
         console.log(email.value.trim());
         var cname = document.getElementById("cname");
         console.log(cname.value.trim());
          var message = document.getElementById("message");
         console.log(message.value.trim());
          var date = document.getElementById("date");
         var data = {
          "key": fname.value + lname.value + date.value + '&fname=' + fname.value.trim() + '&lname=' + lname.value.trim() + '&email=' + email.value.trim() + '&company=' +  cname.value.trim() + '&message=' + message.value.trim() + '&date=' + date.value + '&checkin=walkin',
          "fname": fname.value,
          "lname": lname.value,
           "mobile": mobile,
           "ipad": ipad
         }
        if (fname.value != null &&  fname.value != '' && lname.value != null &&  lname.value != '' && date.value != null &&  date.value != '' && cname.value != null &&  cname.value != '' && message.value != null &&  message.value != '' && email.value != null &&  email.value != '') {
     createqrcode(data);
} else {
    alert("All fields required!")
}
        }
  function download(){
    document.getElementById("downloader").download = "download.png";
    document.getElementById("downloader").href = document.getElementById("qrcode").toDataURL("image/png").replace(/^data:image\/[^;]/, 'data:application/octet-stream');
}
      
      const currentDateTime = () => {
  var tzoffset = new Date().getTimezoneOffset() * 60000; //offset in milliseconds
  var localISOString = new Date(Date.now() - tzoffset)
    .toISOString()
    .slice(0, -1);

  // convert to YYYY-MM-DDTHH:MM
  const datetimeInputString = localISOString.substring(
    0,
    ((localISOString.indexOf("T") | 0) + 6) | 0
  );
  console.log(datetimeInputString);
  return datetimeInputString;
};
     
     var createqrcode = function(data){
       console.log("mobile:" + mobile);
       console.log("ipad:" + ipad);
        var key = data["key"];
       if (mobile === 'Yes'){
         document.getElementById('note').innerHTML= "Thank you, " + data["fname"] + " " + data["lname"] + "<br><br>Scan below QR Code to iPad app to check-in";
       // document.getElementById('createrecord').innerHTML= "<b>iPad Users:</b><br><a href='" + "https://aquafrontdesk.github.io/?key=" + key + "'>click here to complete check-in process</a>";
       }
         if (ipad === 'Yes'){
         document.getElementById('note').innerHTML= "Thank you, " + data["fname"] + " " + data["lname"]; // + "<br><br><b>Mobile Phone Users:</b><br>Scan below QR Code to iPad app to check-in";
        document.getElementById('createrecord').innerHTML= "<b>iPad Users:</b><br><a href='" + "https://aquafrontdesk.github.io/?key=" + key + "'>click here to complete check-in process</a>";
       }
       
         var qrcode = new QRious({
  element: document.getElementById("qrcode"),
  background: '#ffffff',
  backgroundAlpha: 1,
  foreground: '#5868bf',
  foregroundAlpha: 1,
  level: 'H',
  padding: 20,
  size: 250,
  value: key
});

       document.getElementById("myViewport").setAttribute("content", "initial-scale=1.0, width=device-width, user-scalable=yes, minimum-scale=1.0, maximum-scale=1.0");
        document.getElementById('qr').style.display = 'contents';
       document.getElementById('container').style.visibility = 'hidden';
        document.getElementById('header').style.display = 'none';
         document.getElementById('container').style.display = 'none';
       document.getElementById('lname').style.visibility = 'hidden';
       document.getElementById('date').style.visibility = 'hidden';
         document.getElementById('reset').style.visibility = 'hidden';
         document.getElementById('header').style.visibility = 'hidden';
       document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
      }
     
      var loadweb = function(){
      window.location.href = window.location.pathname;
       }
      document.getElementById("get_qr_code").addEventListener("click", get_qr_code);
   document.getElementById("reset").addEventListener("click", loadweb);
      document.getElementById('date').value = currentDateTime();

      
        var queryString = window.location.search;
      console.log(queryString);
      var urlParams = new URLSearchParams(queryString);
      
      var keyid = urlParams.get('key')
      console.log(keyid);
      
      var gmobile = urlParams.get('mobile')
      console.log(mobile);
      
      var gipad = urlParams.get('ipad')
      console.log(ipad);
      
// mobile string
if (gmobile != null && gmobile != '') {
  console.log('string is NOT empty');
        mobile="Yes";
} else {
  console.log('string IS empty');
}
      
// keyid string
if (gipad != null && gipad != '') {
  console.log('string is NOT empty');
   gipad="Yes";

} else {
  console.log('string IS empty');
}
     
// keyid string
if (keyid != null && keyid != '') {
  console.log('string is NOT empty');
  var data = {
          "key": keyid + "&checkin=Now"
        }
        key_id="";
        createqrcode(data);
} else {
  console.log('string IS empty');
}
        
        })();
  </script>
</html>
